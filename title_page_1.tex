%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% University Assignment Title Page 
% LaTeX Template
% Version 1.0 (27/12/12)
%
% This template has been downloaded from:
% http://www.LaTeXTemplates.com
%
% Original author:
% WikiBooks (http://en.wikibooks.org/wiki/LaTeX/Title_Creation)
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
% 
% Instructions for using this template:
% This title page is capable of being compiled as is. This is not useful for 
% including it in another document. To do this, you have two options: 
%
% 1) Copy/paste everything between \begin{document} and \end{document} 
% starting at \begin{titlepage} and paste this into another LaTeX file where you 
% want your title page.
% OR
% 2) Remove everything outside the \begin{titlepage} and \end{titlepage} and 
% move this file to the same directory as the LaTeX file you wish to add it to. 
% Then add \input{./title_page_1.tex} to your LaTeX file where you want your
% title page.
%t
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Chatbot hỗ trợ thương mại điện tử}
%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt]{article}
\usepackage[T5]{fontenc}
\usepackage[utf8]{inputenc}
%\usepackage[utf8]{vietnam}
\usepackage{indentfirst} % thục dòng cái dòng đầu tiên 
\usepackage[vietnamese,english]{babel}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{listings}
\usepackage{xcolor}
\lstset{basicstyle=\ttfamily,
  showstringspaces=false,
%   commentstyle=\color{red},
%   keywordstyle=\color{blue}
}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
}

\renewcommand{\figurename}{Hình }
\renewcommand{\lstlistingname}{Mã }% Listing -> Algorithm

\begin{document}

\begin{titlepage}

\newcommand{\HRule}{\rule{\linewidth}{0.5mm}} % Defines a new command for the horizontal lines, change thickness here

\center % Center everything on the page
 
%----------------------------------------------------------------------------------------
%	HEADING SECTIONS
%----------------------------------------------------------------------------------------

\textsc{\LARGE Đại học Khoa học tự nhiên}\\[1.5cm] % Name of your university/college
\textsc{\Large Ngành hệ thống thông tin}\\[0.5cm] % Major heading such as course name
\textsc{\large Môn học: HỆ CƠ SỞ DỮ LIỆU NÂNG CAO }\\[0.5cm] % Minor heading such as course title

%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\HRule \\[0.4cm]
{ \huge \bfseries 
Chatbot hỗ trợ thương mại điện tử
}\\[0.4cm] % Title of your document
\HRule \\[1.5cm]
 
%----------------------------------------------------------------------------------------
%	AUTHOR SECTION
%----------------------------------------------------------------------------------------

\begin{minipage}{0.5 \textwidth}
\begin{flushleft} \large
\emph{Học viên:}\\
Thái Thiện 17C12031 \\ % Your name
Lê Võ Minh Thư 17C12033
\end{flushleft}
\end{minipage}
~
\begin{minipage}{0.45 \textwidth}
\begin{flushright} \large
\emph{Giảng viên:} \\
TS. Nguyễn Trần Minh Thư % Supervisor's Name
\end{flushright}
\end{minipage}\\[1cm]

% If you don't want a supervisor, uncomment the two lines below and remove the section above
%\Large \emph{Author:}\\
%John \textsc{Smith}\\[3cm] % Your name

%----------------------------------------------------------------------------------------
%	DATE SECTION
%----------------------------------------------------------------------------------------

% I don't want day because it is English
% {\large \today}\\[2cm] % Date, change the \today to a set date if you want to be precise

%----------------------------------------------------------------------------------------
%	LOGO SECTION
%----------------------------------------------------------------------------------------

\includegraphics{logo/rsz_3logo-khtn.png}\\[1cm] % Include a department/university logo - this will require the graphicx package
 
%----------------------------------------------------------------------------------------

\vfill % Fill the rest of the page with whitespace

\end{titlepage}


\section{Bài toán đặt ra}

\subsection{Chatbot}
	Chatbot là một hệ thống tự động có thể giao tiếp với người dùng để thực hiện các thao tác được lập trình sẵn.  Trong thương mại điện tử, Chatbot được dùng thay nhân viên trực tổng đài để tiếp khách hàng và giúp đỡ khách hàng một số tác vụ đơn giản như tìm kiếm sản phẩm. Từ đó giúp tiết kiệm nhân công, kênh liên lạc luôn thông suốt.
	

\subsection{Thông tin ứng dụng}

Trong đồ án này, nhóm chúng tôi xây dựng một chatbot cho trang thương mại điện tử "Xưởng may Thiên Phúc\footnote{\url{http://xuongmaythienphuc.vn/}}". Chatbot sẽ có tính năng chính là tìm kiếm và hiển thị thông tin sản phẩm. Mỗi sản phẩm trả về sẽ kèm đường dẫn tới trang thương mại điện tử, giúp khách hàng dễ dàng đăt hàng.


%%%%%%%%%%%%%%%%%%%%%START EXAMPLE THING%%%%%%%%%%%%%%%
% % % Commands to include a figure:
% \begin{figure}[h]
% \centering
% \includegraphics[width=0.5\textwidth]{image/node.PNG}
% \caption{\label{fig:node} Nút}
% \end{figure}


% % chuong 3
% \section{Chèn đoạn code}


% ví dụ code \ref{lst:vdcode} là code python 


% \begin{lstlisting}[caption={Đoạn code}, label={lst:vdcode}, language=python]
% s = "I am Pusheen the cat"
% print(s)
% \end{lstlisting}

% ví dụ trích dẫn \cite{robinson2013graph}
%%%%%%%%%%%%%% END EXAMPLE THING %%%%%%%%%%%%%%%%%%%%%%%%%

\section{Xây dựng ứng dụng}

\subsection{Mô hình hóa dữ liệu}

Dữ liệu nhập vào sẽ có dạng bảng có nhiều cột. Nhưng ta chỉ cần quan tâm 4 cột: Nhóm hàng, Mã hàng, Tên hàng, Giá bán. Dữ liệu cần nhập vào có bảng như dưới đây.

\begin{center}
 \begin{tabular}{||c c c c||} 
 \hline
 Nhóm hàng & Mã hàng & Tên hàng & Giá bán \\ [0.5ex] 
 \hline\hline
 Đồ Bộ Nữ & 1675NgoiXLSale & Set Bộ Dài Cam Ngói Phối Màu Sành Điệu & 120000 \\ 
 \hline
 Đầm dự tiệc & 1628DoXXLSale & Đầm đỏ body dự tiệc phối ren đuôi cá & 155000 \\
 \hline
  Đầm dự tiệc & 1573LSale & Đầm form chữ A tay ren cổ kết pha lê  & 120000 \\ [1ex] 
 \hline
\end{tabular}
\end{center}

Dữ liệu trong Neo4j sẽ có 4 thực thể: \pagebreak

\textbf{PRODUCT} : Sản phẩm 
\begin{itemize}
\item name (String) : Tên sản phẩm, lấy trực tiếp từ cột Tên Hàng trong bảng nguồn. 
\item normalized\_name (String) : Tên sản phẩm sau khi chuẩn hóa bằng cách bỏ dấu tiếng Việt và đổi sang viết thường. Chuẩn hóa giúp truy vấn tiếng Việt không dấu. 
\item url (String) : Đường dẫn tới sản phẩm trên trang "Xưởng may Thiên Phúc" 
\end{itemize}


\textbf{CATEGORY} : Nhóm hàng 
\begin{itemize}
\item name (String) : Tên nhóm hàng, lấy trực tiếp từ cột Nhóm hàng trong bảng nguồn
\item normalized\_name (String) : Tên nhóm hàng sau khi chuẩn hóa bằng cách bỏ dấu tiếng Việt và đổi sang viết thường. Chuẩn hóa giúp truy vấn tiếng Việt không dấu. 
\end{itemize}

\textbf{ITEM} : Mặt hàng. 
\begin{itemize}
\item code (String) : Mã hàng trong bảng nguồn. 
\item price (int) : giá tiền (đơn vị VND)  
\end{itemize}

Quan hệ giữa các thực thể 
\begin{itemize}
\item Một PRODUCT có từ 1 đến n quan hệ BELONG\_TO với CATEGORY
\item Một CATEGORY có từ 1 đến n quan hệ BELONG\_TO với PRODUCT
\item Một PRODUCT có từ 1 đến n quan hệ HAS với ITEM 
\item Một ITEM chỉ có 1 quan hệ HAS đến 1 PRODUCT 
\end{itemize}

CÓ thể diễn đạt bằng lời thế này: Mỗi sản phẩm thuộc nhiều nhóm hàng và có nhiều mặt hàng. Mội mặt hàng chỉ thuộc về một sản phẩm. 

Hình \ref{fig:datastructure} biểu diễn mối quan hệ giữa các thực thể. Hình \ref{fig:datastructureexample} biểu diễn trực quan hóa trên Neo4j gồm một CATEGORY (Nhóm hàng) với 2 PRODUCT (Sản phẩm) và các ITEM (mặt hàng) của mỗi sản phẩm.  

% Commands to include a figure:
\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{image/neo4jdatastructure.png}
\caption{\label{fig:datastructure} Sơ đồ đồ quan hệ các thực thể}
\end{figure}


\begin{figure}[h]
\centering
\includegraphics[width=0.5\textwidth]{imagev2/vddatamodel.png}
\caption{\label{fig:datastructureexample} Ví dụ đơn giản}
\end{figure}


\subsection{Chuyển đổi và nạp dữ liệu}



\subsection{Chatbot nền tảng Telegram}

\section{Triển khai ứng dụng}

\subsection{Cài đặt hệ thống}

Ứng dụng nên được triển khai trên hệ điều hành Ubuntu 18.04 LTS hoặc 16.04 LTS. Các yêu cầu: 

\begin{itemize}
\item Java (cài bằng sdkman \footnote{\url{https://sdkman.io/}})
\item gradle (cài bằng sdkman)
\item Python 3.6 (cài bằng Anaconda \footnote{\url{https://www.anaconda.com/download/}}hoặc Miniconda \footnote{\url{https://conda.io/miniconda.html}})
\end{itemize}

\subsection{Cài đặt và nạp dữ liệu vào Neo4j}
\subsubsection{Cài đặt Neo4j} \label{sec:installneo4jinstance}

Có 2 cách để cài đặt Neo4j: cài thông qua Neo4j Desktop hoặc cài trực tiếp Neo4j Community Edition

Tải bản Neo4j Desktop tại trang chủ \footnote{Tải về Neo4j Desktop https://neo4j.com/developer/guide-neo4j-desktop/} và cài đặt. Neo4j Desktop hỗ trợ những công cụ cần thiết để dựng một cơ sở dữ liệu trên máy cá nhân. Chạy Neo4j Desktop để tạo một graph database ở localhost (trên máy cá nhân). Phương pháp này chỉ nên dùng để thử nghiệm và sử dụng trong quá trình phát triển phần mềm, không nên dùng khi triển khai (Chạy thực tế)

Để cài đặt Neo4j Community Edition, làm theo hướng dẫn \footnote{https://neo4j.com/docs/operations-manual/current/installation/linux/debian/}. Cụ thể, chỉ cần chạy các câu lệnh sau (Mã \ref{lst:neo4jinstall})

\begin{lstlisting}[basicstyle=\tiny,language=bash,caption={Cài Neo4j},label={lst:neo4jinstall}]
wget -O - https://debian.neo4j.org/neotechnology.gpg.key | sudo apt-key add -
echo 'deb https://debian.neo4j.org/repo stable/' | sudo tee -a /etc/apt/sources.list.d/neo4j.list
sudo apt-get update
sudo apt-get install neo4j=1:3.4.5
\end{lstlisting}

\subsection{Nạp dữ liệu vào Neo4j}

Dữ liệu thô từ trang thương mại điện tử có dạng Excel như sau: 

% TODO: gắn hình vào

Tập tin dữ liệu Excel nằm ở đường dẫn \url{csdlnc_util\\data\\DanhSachSanPham.xlsx}. Ta sẽ dùng các đoạn mã Python (thư mục csdlnc-util) để chuyển Excel thành Neo4j Cypher rồi chạy các cypher để nạp vào cơ sở dữ liệu. 

Yêu cầu các gói Python sau (có thể dùng câu lệnh pip install tên\_gói để cài đặt): 

\begin{itemize}
\item neo4j-driver
\item Unidecode 
\item openpyxl
\end{itemize}

Trước tiên, cần mỡ ex\_cypher\_file.py để thay đổi thông tin cơ sở dữ liệu. Tìm đoạn mã nguồn như Mã \ref{list:neo4jauth} và thay vào thông tin của Neo4j đã cài ở mục \ref{sec:installneo4jinstance}.

\begin{lstlisting}[language=python,caption={Thông tin Neo4j},label={list:neo4jauth}]
    uri = "bolt://188.166.233.199:7687"
    auth = ("tthien", "neo4jmeow")
\end{lstlisting}

Sau đó, chạy các dòng lệnh sau (Mã \ref{list:loadneo4jdata}) để nạp dữ liệu vào Neo4j.

\begin{lstlisting}[language=bash,caption={Cài Neo4j},label={list:loadneo4jdata}]
python import_product.py # chuyen Excel qua Cypher
python ex_cypher_file.py outcypher.txt # nap vao neo4j 
\end{lstlisting}

\subsection{Chatbot}
\subsubsection{Cài đặt tài khoản Bot trên Telegram}
Thực hiện các bước sau
\begin{itemize}
\item Tải ứng dụng Telegram vào điện thoại hoặc dùng bảng web \footnote{\url{https://web.telegram.org/}}
\item Tạo tài khoảng 
\item Liên hệ @BotFather \footnote{\url{https://t.me/botfather}} để tạo Bot và lấy API Token \footnote{API Token giống thế này: 681953844:AAF67DFPwTGuzHtPwZvGs1mjmLZ85IHTNmk}. 
\item Ghi lại tên bot và API Token 
\end{itemize}

\subsubsection{Chạy ứng dụng Chatbot}

Lần lượt chạy các đoạn Mã \ref{list:compiletelegrambot}, \ref{list:envtelegrambot}, \ref{list:runtelegrambot} để chạy bot. 

\begin{lstlisting}[language=bash,caption={Biên dịch mã nguồn},label={list:compiletelegrambot}]
gradle stage 
\end{lstlisting}

\begin{lstlisting}[language=bash,caption={Tạo các biến môi trường},label={list:envtelegrambot}]
export DEV_BOT_TOKEN=api_token
export DEV_BOT_NAME=ten_bot
export NEO4J_IP="localhost" 
export NEO4J_BOLT_PORT="7687"
export NEO4J_USERNAME="neo4j"
export NEO4J_PASSWORD=mat_khau_neo4j
\end{lstlisting}

\begin{lstlisting}[language=bash,caption={Chạy bot},label={list:runtelegrambot}]
java -jar build/libs/telegrambot-3.0-all.jar
\end{lstlisting}

\bibliographystyle{IEEEtran}
\bibliography{bib}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Comments can be added to the margins of the document using the \todo{Here's a comment in the margin!} todo command, as shown in the example on the right. You can also add inline comments too:

% \todo[inline, color=green!40]{This is an inline comment.}



% \subsection{Tables and Figures}

% Use the table and tabular commands for basic tables --- see Table~\ref{tab:widgets}, for example. You can upload a figure (JPEG, PNG or PDF) using the files menu. To include it in your document, use the includegraphics command as in the code for Figure~\ref{fig:frog} below.

% % % Commands to include a figure:
% % \begin{figure}
% % \centering
% % \includegraphics[width=0.5\textwidth]{frog.jpg}
% % \caption{\label{fig:frog}This is a figure caption.}
% % \end{figure}

% % \begin{table}
% % \centering
% % \begin{tabular}{l|r}
% % Item & Quantity \\\hline
% % Widgets & 42 \\
% % Gadgets & 13
% % \end{tabular}
% % \caption{\label{tab:widgets}An example table.}
% % \end{table}

% \subsection{Mathematics}

% \LaTeX{} is great at typesetting mathematics. Let $X_1, X_2, \ldots, X_n$ be a sequence of independent and identically distributed random variables with $\text{E}[X_i] = \mu$ and $\text{Var}[X_i] = \sigma^2 < \infty$, and let
% $$S_n = \frac{X_1 + X_2 + \cdots + X_n}{n}
%       = \frac{1}{n}\sum_{i}^{n} X_i$$
% denote their mean. Then as $n$ approaches infinity, the random variables $\sqrt{n}(S_n - \mu)$ converge in distribution to a normal $\mathcal{N}(0, \sigma^2)$.

% \subsection{Lists}

% You can make lists with automatic numbering \dots

% \begin{enumerate}
% \item Like this,
% \item and like this.
% \end{enumerate}
% \dots or bullet points \dots
% \begin{itemize}
% \item Like this,
% \item and like this.
% \end{itemize}

% We hope you find write\LaTeX\ useful, and please let us know if you have any feedback using the help menu above.

\end{document}